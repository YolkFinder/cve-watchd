#!/bin/bash

# Set up directories and copy files
sudo mkdir /etc/cve-watchd
sudo cp config.yaml /etc/cve-watchd/
sudo cp rss.txt /etc/cve-watchd/
sudo cp monitored.txt /etc/cve-watchd/
sudo cp ignore.txt /etc/cve-watchd/
sudo cp cve-watchd /usr/bin/

# Set permissions
sudo chmod 755 /usr/bin/cve-watchd
sudo chown root:root /usr/bin/cve-watchd
sudo chmod 644 /etc/cve-watchd/*

# Create systemd unit file
sudo bash -c 'cat > /etc/systemd/system/cve-watchd.service << EOF
[Unit]
Description=CVE Watchdog Daemon
After=network.target

[Service]
Type=simple
Restart=always
RestartSec=5s
User=root
Group=root
ExecStart=/usr/bin/cve-watchd --config /etc/cve-watchd/config.yaml --rss /etc/cve-watchd/rss.txt --monitored /etc/cve-watchd/monitored.txt --ignore /etc/cve-watchd/ignore.txt
ExecStop=/bin/kill -TERM $MAINPID

[Install]
WantedBy=multi-user.target
EOF'

# Reload systemd configuration and start service
sudo systemctl daemon-reload
sudo systemctl enable cve-watchd.service
sudo systemctl start cve-watchd.service

